<div class="project-form-container">
    <div class="form-header">
        <h2>Nouveau Dossier ATI</h2>
        <p class="subtitle">Saisie des informations re√ßues par courriel</p>
    </div>

    <form [formGroup]="projectForm" (ngSubmit)="onSubmit()" class="premium-form">

        <!-- Section 1: Informations G√©n√©rales -->
        <section class="form-section">
            <h3>Informations G√©n√©rales</h3>

            <div class="form-group">
                <label for="title">Nom du Projet / Dossier</label>
                <input id="title" type="text" formControlName="title"
                    placeholder="Ex: Projet Mine Alpha - Demande 2023-10">
                <div class="error" *ngIf="projectForm.get('title')?.touched && projectForm.get('title')?.invalid">
                    Le nom est requis.
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sender">Source de la demande</label>
                    <select id="sender" formControlName="sender">
                        <option value="" disabled>S√©lectionner la source</option>
                        <option value="MINING_CO">Compagnie Mini√®re</option>
                        <option value="MINISTRY">Minist√®re (MERN/MELCCFP)</option>
                        <option value="CITIZEN">Citoyen / Autre</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="receivedDate">Date de r√©ception</label>
                    <input id="receivedDate" type="date" formControlName="receivedDate">
                </div>
            </div>
        </section>

        <!-- Section 2: Contenu -->
        <section class="form-section">
            <h3>Contenu de la Demande</h3>

            <div class="form-group">
                <label for="emailContent">Contenu du courriel / Description</label>
                <textarea id="emailContent" formControlName="emailContent" rows="6"
                    placeholder="Copiez le contenu du courriel ici..."></textarea>
                <div class="error"
                    *ngIf="projectForm.get('emailContent')?.touched && projectForm.get('emailContent')?.invalid">
                    La description est requise.
                </div>
            </div>

            <div class="form-group">
                <label for="files">Documents joints (PDF, Cartes)</label>
                <div class="file-upload-wrapper">
                    <input type="file" id="files" (change)="onFileSelected($event)" multiple
                        accept=".pdf,.png,.jpg,.jpeg">
                    <div class="upload-placeholder">
                        <span class="icon">üìé</span>
                        <span>Glissez vos fichiers ici ou cliquez pour parcourir</span>
                    </div>
                </div>
                <div class="file-list" *ngIf="selectedFiles.length > 0">
                    <div class="file-item" *ngFor="let file of selectedFiles">
                        üìÑ {{ file.name }} ({{ (file.size / 1024 / 1024) | number:'1.1-2' }} MB)
                    </div>
                </div>
            </div>
        </section>

        <!-- Progress Indicator -->
        <div class="progress-indicator" *ngIf="isSubmitting">
            <div class="spinner"></div>
            <div class="progress-text">
                <p class="current-step">{{ currentStep || 'Cr√©ation en cours...' }}</p>
                <p class="upload-progress" *ngIf="uploadProgress">{{ uploadProgress }}</p>
            </div>
        </div>

        <!-- Actions -->
        <div class="form-actions">
            <button type="button" class="btn-secondary" routerLink="/dashboard" [disabled]="isSubmitting">Annuler</button>
            <button type="submit" class="btn-primary" [disabled]="projectForm.invalid || isSubmitting">
                <span *ngIf="!isSubmitting">Cr√©er le dossier</span>
                <span *ngIf="isSubmitting">En cours...</span>
            </button>
        </div>

    </form>
</div>